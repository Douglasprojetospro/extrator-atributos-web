{% extends "base.html" %}

{% block content %}
<div class="container">
    <div class="row justify-content-center">
        <div class="col-md-10">
            <div class="text-center mb-4">
                <h1 class="display-4">Processamento Automatizado de Planilhas</h1>
                <p class="lead">Identificação de padrões em descrições de produtos</p>
            </div>

            <div class="card shadow-lg">
                <div class="card-header bg-primary text-white">
                    <h3 class="mb-0"><i class="fas fa-file-upload mr-2"></i>Upload da Planilha</h3>
                </div>
                <div class="card-body">
                    <form method="POST" action="{{ url_for('upload_arquivo') }}" enctype="multipart/form-data" id="upload-form">
                        <div class="form-group">
                            <div class="input-group">
                                <div class="custom-file">
                                    <input type="file" class="custom-file-input" id="arquivo" name="arquivo" accept=".xlsx,.xls" required>
                                    <label class="custom-file-label" for="arquivo" id="file-label">Selecione um arquivo Excel (.xlsx, .xls)</label>
                                </div>
                                <div class="input-group-append">
                                    <button type="submit" class="btn btn-success" id="upload-btn">
                                        <i class="fas fa-upload mr-2"></i> Enviar
                                    </button>
                                </div>
                            </div>
                            <small class="form-text text-muted mt-2">
                                <i class="fas fa-info-circle mr-1"></i> A planilha deve conter as colunas <strong>"ID"</strong> e <strong>"Descrição"</strong>
                            </small>
                        </div>
                    </form>

                    <div class="text-center mt-3">
                        <a href="{{ url_for('gerar_modelo') }}" class="btn btn-outline-primary">
                            <i class="fas fa-file-download mr-2"></i> Baixar Modelo de Planilha
                        </a>
                    </div>
                </div>
            </div>

            <div class="row mt-4">
                <div class="col-md-6">
                    <div class="card h-100">
                        <div class="card-header bg-info text-white">
                            <h4 class="mb-0"><i class="fas fa-cogs mr-2"></i>Como Funciona</h4>
                        </div>
                        <div class="card-body">
                            <ol class="pl-3">
                                <li class="mb-2">Faça upload da planilha com produtos</li>
                                <li class="mb-2">Configure os atributos a serem extraídos</li>
                                <li class="mb-2">Defina variações e padrões para cada atributo</li>
                                <li class="mb-2">Processe os dados automaticamente</li>
                                <li>Exporte os resultados para Excel</li>
                            </ol>
                        </div>
                    </div>
                </div>

                <div class="col-md-6">
                    <div class="card h-100">
                        <div class="card-header bg-success text-white">
                            <h4 class="mb-0"><i class="fas fa-lightbulb mr-2"></i>Dicas Importantes</h4>
                        </div>
                        <div class="card-body">
                            <ul class="pl-3">
                                <li class="mb-2">
                                    <strong>Prioridade:</strong> Defina a ordem de importância para padrões que podem conflitar
                                </li>
                                <li class="mb-2">
                                    <strong>Padrões múltiplos:</strong> Use vírgulas para separar variações (ex: 110v,110V,127v)
                                </li>
                                <li class="mb-2">
                                    <strong>Tipos de retorno:</strong> Escolha entre texto fixo, valor numérico ou texto completo
                                </li>
                                <li>
                                    <strong>Configurações:</strong> Salve para reutilizar em outros processamentos
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card mt-4">
                <div class="card-header bg-secondary text-white">
                    <h4 class="mb-0"><i class="fas fa-history mr-2"></i>Últimas Configurações</h4>
                </div>
                <div class="card-body">
                    {% if config_files %}
                        <div class="list-group">
                            {% for file in config_files[:3] %}
                            <div class="list-group-item">
                                <div class="d-flex justify-content-between align-items-center">
                                    <span><i class="fas fa-file-alt mr-2"></i>{{ file }}</span>
                                    <form action="{{ url_for('carregar_configuracao') }}" method="POST" class="d-inline">
                                        <input type="hidden" name="config_file" value="{{ file }}">
                                        <button type="submit" class="btn btn-sm btn-outline-primary">Usar esta</button>
                                    </form>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                        {% if config_files|length > 3 %}
                            <div class="text-center mt-2">
                                <small>+ {{ config_files|length - 3 }} outras configurações disponíveis</small>
                            </div>
                        {% endif %}
                    {% else %}
                        <p class="mb-0 text-muted">Nenhuma configuração salva ainda</p>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>

<script>
$(document).ready(function() {
    // Mostrar nome do arquivo selecionado
    $('#arquivo').change(function() {
        const fileName = $(this).val().split('\\').pop();
        $('#file-label').text(fileName || 'Selecione um arquivo Excel (.xlsx, .xls)');
        
        // Habilitar/desabilitar botão de upload
        $('#upload-btn').prop('disabled', !$(this).val());
    });

    // Feedback durante o upload
    $('#upload-form').submit(function() {
        const btn = $('#upload-btn');
        btn.html('<span class="spinner-border spinner-border-sm mr-2" role="status" aria-hidden="true"></span> Enviando...');
        btn.prop('disabled', true);
    });
});
</script>
{% endblock %}
